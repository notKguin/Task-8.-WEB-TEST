{% extends 'base.html' %}
{% block title %}{{ event.title }}{% endblock %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">

      <div class="card mb-3">
        {% if event.image %}
          <img src="{{ event.image.url }}" class="card-img-top" alt="">
        {% endif %}

        <div class="card-body">
          <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2">
            <div class="small text-muted">{{ event.category.name }}</div>

            <div class="d-flex gap-2">
              <span class="badge text-bg-light border">‚ù§Ô∏è {{ event.likes_count }}</span>
              <span class="badge text-bg-light border">üìù {{ event.applications_count }}</span>
            </div>
          </div>

          <h1 class="h4 mb-1">{{ event.title }}</h1>
          <div class="text-muted small mb-3">{{ event.event_date|date:"d.m.Y H:i" }} ‚Ä¢ {{ event.location }}</div>

          <div class="content-text">
            {{ event.description|linebreaksbr }}
          </div>
        </div>
      </div>

      <!-- –ë–ª–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π: —Å–Ω–∏–∑—É, –µ–¥–∏–Ω—ã–º –±–ª–æ–∫–æ–º -->
      <div class="card">
        <div class="card-body">
          <h2 class="h6 mb-3">–î–µ–π—Å—Ç–≤–∏—è</h2>

          {% if user.is_authenticated %}
            <div class="d-grid gap-2">
              <form method="post" action="{% url 'toggle_like' event.pk %}">
                {% csrf_token %}
                <button type="submit"
                        class="btn w-100 {% if liked %}btn-danger{% else %}btn-outline-danger{% endif %}">
                  {% if liked %}
                    ‚ù§Ô∏è –£–±—Ä–∞—Ç—å –ª–∞–π–∫
                  {% else %}
                    ü§ç –ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫
                  {% endif %}
                  <span class="ms-2 badge text-bg-light border">–í—Å–µ–≥–æ: {{ event.likes_count }}</span>
                </button>
              </form>

              {% if application %}
                <div class="alert alert-success mb-0">
                  –ó–∞—è–≤–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –°—Ç–∞—Ç—É—Å: <b>{{ application.get_status_display }}</b>
                </div>
              {% else %}
                <a class="btn btn-success w-100" href="{% url 'apply_to_event' event.pk %}">
                  üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞
                </a>
              {% endif %}

              <a class="btn btn-outline-secondary w-100" href="{% url 'event_list' %}">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
              </a>
            </div>
          {% else %}
            <div class="alert alert-warning">
              –ß—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫ –∏–ª–∏ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É, –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è.
            </div>
            <div class="d-grid gap-2">
              <a class="btn btn-primary w-100" href="{% url 'login' %}?next={{ request.path }}">–í–æ–π—Ç–∏</a>
              <a class="btn btn-outline-primary w-100" href="{% url 'signup' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
              <a class="btn btn-outline-secondary w-100" href="{% url 'event_list' %}">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
            </div>
          {% endif %}
        </div>
      </div>

    </div>
  </div>
{% endblock %}
